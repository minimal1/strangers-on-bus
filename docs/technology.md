# 기술 스펙

## 개요

Strangers on Bus 프로젝트는 위치 기반 미니게임 서비스로, 견고한 아키텍처와 효율적인 개발 경험을 제공하기 위해 최신 기술 스택을 채택합니다. 이 문서는 프로젝트의 핵심 기술적 결정과 아키텍처 설계 철학을 담고 있습니다.

## 기술 스택

### 프론트엔드

- **프레임워크**: Angular
- **언어**: TypeScript
- **상태 관리**: NgRx (Redux 아키텍처 패턴)
- **UI 컴포넌트**: Angular Material
- **스타일링**: SCSS with BEM 방법론
- **지도/위치 서비스**: Kakao Maps API, Geolocation API

### 백엔드

- **프레임워크**: NestJS
- **언어**: TypeScript
- **런타임**: Node.js
- **데이터베이스**: PostgreSQL
- **ORM**: TypeORM
- **API 문서화**: Swagger/OpenAPI
- **인증**: JWT

### 인프라

- **배포**: Docker, Kubernetes
- **CI/CD**: GitHub Actions
- **모니터링**: Prometheus, Grafana
- **로깅**: ELK Stack

## 아키텍처 결정

### Angular 선택 이유

Angular는 강력한 타입 시스템과 종합적인 프레임워크 접근 방식으로 SOLID 원칙과 OOP 패턴을 적용하기에 최적화된 환경을 제공합니다:

1. **의존성 주입 시스템**: Angular의 내장 DI 시스템은 컴포넌트 간 느슨한 결합을 촉진하고, 테스트 용이성을 높입니다.
2. **모듈화**: NgModules를 통한 코드 분리로 단일 책임 원칙(SRP)을 쉽게 구현할 수 있습니다.
3. **반응형 프로그래밍**: RxJS와의 통합으로 선언적이고 함수형 프로그래밍 패러다임을 지원합니다.
4. **컴포넌트 기반 설계**: 명확한 컴포넌트 계층 구조가 개방-폐쇄 원칙(OCP)을 자연스럽게 따르도록 유도합니다.

### NestJS 선택 이유

NestJS는 Angular에서 영감을 받은 백엔드 프레임워크로, 프론트엔드와 백엔드 간의 일관된 개발 경험을 제공합니다:

1. **모듈 시스템**: 기능별 모듈 분리로 코드 구성과 유지보수가 용이합니다.
2. **데코레이터 패턴**: TypeScript 데코레이터를 통한 선언적 메타데이터 정의로 코드 가독성이 향상됩니다.
3. **미들웨어 아키텍처**: 요청 파이프라인 처리를 위한 체계적인 구조를 제공합니다.
4. **플러그인 시스템**: 필요한 기능만 추가할 수 있는 확장성을 제공합니다.

### PostgreSQL 선택 이유

위치 기반 서비스와 정형화된 게임 데이터를 효율적으로 저장하고 쿼리하기 위해 PostgreSQL을 선택했습니다:

1. **지리 정보 지원**: PostGIS 확장을 통한 위치 데이터 처리 및 공간 쿼리 기능
2. **JSONB 타입**: 유연한 스키마 설계와 비정형 데이터 저장 가능
3. **강력한 인덱싱**: 다양한 인덱스 타입으로 쿼리 성능 최적화
4. **트랜잭션 안정성**: ACID 준수로 데이터 무결성 보장

## 아키텍처 설계 원칙

### 1. 클린 아키텍처

프로젝트는 내부 비즈니스 로직이 외부 인프라스트럭처에 의존하지 않도록 계층화된 설계를 채택합니다:

- **도메인 계층**: 핵심 비즈니스 로직 및 엔티티
- **애플리케이션 계층**: 유스케이스 구현
- **인프라스트럭처 계층**: 외부 시스템 연동
- **인터페이스 계층**: API 및 UI 구현

### 2. SOLID 원칙 적용

- **단일 책임 원칙(SRP)**: 각 클래스는 명확한 단일 책임을 가집니다.
- **개방-폐쇄 원칙(OCP)**: 확장에는 열려있고 수정에는 닫혀있는 설계를 지향합니다.
- **리스코프 치환 원칙(LSP)**: 상속 관계에서 하위 타입은 상위 타입을 대체할 수 있어야 합니다.
- **인터페이스 분리 원칙(ISP)**: 클라이언트가 사용하지 않는 인터페이스에 의존하지 않도록 설계합니다.
- **의존성 역전 원칙(DIP)**: 구체적인 구현보다 추상화에 의존하도록 설계합니다.

### 3. 함수형 프로그래밍 요소

- **불변성(Immutability)**: 상태 변경 대신 새로운 객체 생성을 선호합니다.
- **순수 함수(Pure Functions)**: 부작용 없는 함수로 예측 가능성을 높입니다.
- **고차 함수(Higher-Order Functions)**: 함수를 인자로 받거나 반환하는 패턴을 활용합니다.
- **모나딕 에러 처리**: Either 또는 Option 패턴을 통한 우아한 에러 처리를 구현합니다.

## 웹 플랫폼 선택과 확장성

초기 구현은 웹 브라우저 환경을 타겟으로 하며, 다음과 같은 확장 가능성을 고려합니다:

### 웹 플랫폼 접근 방식

- **프로그레시브 웹 앱(PWA)**: 모바일 사용자 경험과 오프라인 기능을 강화한 웹 애플리케이션으로 구현
- **반응형 디자인**: 모바일 최적화 UI로 네이티브 앱 수준의 사용자 경험 제공
- **위치 서비스**: 웹 브라우저의 Geolocation API를 활용한 위치 기반 기능 구현

### 모바일 확장 고려사항

현재 선택한 기술 스택은 향후 모바일 네이티브 앱으로 확장 시 다음과 같은 접근 방식을 취할 수 있습니다:

1. **하이브리드 앱 전환**: Capacitor/Cordova를 활용하여 기존 Angular 코드베이스를 모바일 앱으로 포팅
   - **장점**: 코드베이스 공유로 개발 효율성 유지
   - **단점**: 네이티브 앱 대비 일부 성능 제한

2. **크로스 플랫폼 프레임워크 마이그레이션**: Angular에서 NativeScript 또는 Ionic으로 마이그레이션
   - **장점**: Angular 지식과 패턴을 재활용 가능
   - **단점**: 부분적 코드 재작성 필요

3. **네이티브 앱 개발**: 필요시 Android(Kotlin), iOS(Swift) 네이티브 앱 별도 개발
   - **장점**: 최적의 성능과 네이티브 기능 활용
   - **단점**: 별도 코드베이스 관리 필요

## 성능 최적화 전략

### 프론트엔드

- **Change Detection 최적화**: OnPush 전략 적용
- **코드 스플리팅**: 지연 로딩을 통한 초기 로드 시간 최소화
- **메모이제이션**: 순수 파이프와 memoized 셀렉터를 통한 계산 최적화
- **가상 스크롤**: 대량의 리스트 데이터 처리 최적화

### 백엔드

- **커넥션 풀링**: 데이터베이스 연결 효율적 관리
- **캐싱 전략**: Redis를 활용한 자주 접근하는 데이터 캐싱
- **비동기 처리**: 이벤트 기반 아키텍처로 I/O 바운드 작업 최적화
- **마이크로서비스 고려**: 필요시 부하가 높은 서비스 분리

## Node.js 이벤트 기반 런타임의 적합성

Node.js의 이벤트 기반, 비동기 I/O 모델은 Strangers on Bus 프로젝트에 다음과 같은 이점을 제공합니다:

1. **동시성 처리**: 많은 사용자의 위치 업데이트와 게임 세션을 효율적으로 처리
2. **I/O 작업 최적화**: 데이터베이스 쿼리, 외부 API 호출 등의 비동기 처리가 자연스러움
3. **실시간 기능**: 위치 업데이트, 랭킹 변동 등의 실시간 이벤트 처리에 적합
4. **JavaScript 생태계**: 프론트엔드와 백엔드 모두 TypeScript를 사용함으로써 개발 경험 일관성 유지

특히 짧은 게임 세션과 간헐적인 위치 업데이트가 주를 이루는 이 프로젝트의 특성상, CPU 집약적 연산보다 다수의 동시 연결과 I/O 작업 처리가 중요하므로 Node.js는 적합한 선택입니다.

## 향후 기술 검토 항목

프로젝트 진행 상황에 따라 다음 기술 도입을 검토할 수 있습니다:

- **실시간 통신**: WebSockets 또는 Server-Sent Events를 통한 실시간 랭킹 업데이트
- **Analytics 플랫폼**: 사용자 행동 패턴 및 게임 데이터 분석
- **AI/ML 통합**: 사용자 패턴 기반 게임 추천 또는 난이도 조정
- **서버리스 아키텍처**: 특정 기능을 서버리스 함수로 마이그레이션하여 확장성 개선
